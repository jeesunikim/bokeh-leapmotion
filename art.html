<!DOCTYPE html>
	<html lang="en">
	<head>
		<title>Leap Motion</title>
		<style>
			body {
				/*background-color: #000000;*/
				color: #ffffff;
			}
		</style>
	</head>
	<body>
		<h1>Art Show</h1>

		<div id="output"></div>

		<script src=http://rawgit.com/mrdoob/three.js/dev/build/three.min.js ></script>
		<script src=http://rawgit.com/mrdoob/three.js/dev/examples/js/controls/OrbitControls.js ></script>
		<script src=http://rawgit.com/mrdoob/three.js/dev/examples/js/libs/stats.min.js ></script>
		<script src="https://js.leapmotion.com/leap-0.6.4.js"></script>
		<script src="assets/js/LeapSpringCtrl.js"></script>
		<script src="assets/js/LeapCameraCtrl.js"></script>
		<script src="assets/js/LeapObjectCtrl.js"></script>
		<script>
			var baseBoneRotation = ( new THREE.Quaternion ).setFromEuler( new THREE.Euler( 0, 0, Math.PI / 2 ) );
			var armMeshes = [];
			var boneMeshes = [];
			var stats, renderer, scene, camera, controls, LeapControls, CameraControls, controller;
			init();

			Leap.loop( {background: true}, leapAnimate ).connect();
			
			function init() {

				controller = new Leap.Controller();
				
				// var menu = document.body.appendChild( document.createElement( 'div' ) );
				// menu.id = 'menu';
				// menu.innerHTML =
				// `<div id=info ></div>`;
				stats = new Stats();
				stats.domElement.style.cssText = 'position: absolute; right: 0; top: 0; z-index: 100; ';
				document.body.appendChild( stats.domElement );
				renderer = new THREE.WebGLRenderer( { alpha: 1, antialias: true, clearColor: 0xffffff }  );
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.body.appendChild( renderer.domElement );

				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 1000 );
				
				camera.position.y = 100;
				camera.position.z = 500;
				
				controls = new THREE.OrbitControls( camera, renderer.domElement );
				
				scene = new THREE.Scene();
				scene.background = new THREE.Color( 0xf0f0f0 );

				var gridHelper = new THREE.GridHelper( 150, 10 );
				scene.add( gridHelper );
				var axisHelper = new THREE.AxisHelper( 150 );
				scene.add( axisHelper );
				var geometry = new THREE.BoxGeometry( 300, 20, 300 );

				var material = new THREE.MeshNormalMaterial();
				var mesh = new THREE.Mesh( geometry, material );
				mesh.position.set( 0, -10, 0 );
				scene.add( mesh );
				addCube();

				// LeapControls = new THREE.LeapSpringControls( camera , controller , scene );

				// cameraControls = new THREE.LeapCameraControls(camera);

				// cameraControls.rotateEnabled  = true;
				// cameraControls.rotateSpeed    = 3;
				// cameraControls.rotateHands    = 1;
				// cameraControls.rotateFingers  = [2, 3];

				// cameraControls.zoomEnabled    = true;
				// cameraControls.zoomSpeed      = 6;
				// cameraControls.zoomHands      = 1;
				// cameraControls.zoomFingers    = [4, 5];
				// cameraControls.zoomMin        = 50;
				// cameraControls.zoomMax        = 2000;

				// cameraControls.panEnabled     = true;
				// cameraControls.panSpeed       = 2;
				// cameraControls.panHands       = 2;
				// cameraControls.panFingers     = [6, 12];
				// cameraControls.panRightHanded = false; 
				// for left-handed person

				// LeapControls.dampening      = .75;
		        // LeapControls.size           = 120;
		        // LeapControls.springConstant =   1;
		        // LeapControls.mass           = 100;
		        // LeapControls.anchorSpeed    =  .1;
		        // LeapControls.staticLength   = 100;

				// var geo = new THREE.IcosahedronGeometry( 5, 2 ); 
		        // var mat = new THREE.MeshNormalMaterial(); 

				// var targetMesh  = new THREE.Mesh( geometry , mat );
		        // var anchorMesh  = new THREE.Mesh( geometry , mat );
		        // var handMesh    = new THREE.Mesh( geometry , mat );

		        // LeapControls.addTargetMarker( targetMesh );
		        // LeapControls.addAnchorMarker( anchorMesh );
		        // LeapControls.addHandMarker(     handMesh );
				
				controls.maxDistance = 1000;
				window.addEventListener( 'resize', onWindowResize, false );
			}

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}

			function addMesh( meshes ) {
				var geometry = new THREE.BoxGeometry( 1, 1, 1 );
				var material = new THREE.MeshNormalMaterial();
				var mesh = new THREE.Mesh( geometry, material );
				meshes.push( mesh );
				return mesh;
			}

			function updateMesh( bone, mesh ) {
				mesh.position.fromArray( bone.center() );
				mesh.setRotationFromMatrix( ( new THREE.Matrix4 ).fromArray( bone.matrix() ) );
				mesh.quaternion.multiply( baseBoneRotation );
				mesh.scale.set( bone.width, bone.width, bone.length );
				scene.add( mesh );
			}

			function addCube () {
				var geometry = new THREE.BoxGeometry( 200, 200, 200 );
				for ( var i = 0; i < geometry.faces.length; i += 2 ) {
					var hex = Math.random() * 0xffffff;
					geometry.faces[ i ].color.setHex( hex );
					geometry.faces[ i + 1 ].color.setHex( hex );
				}
				var material = new THREE.MeshBasicMaterial( { vertexColors: THREE.FaceColors, overdraw: 0.5 } );
				cube = new THREE.Mesh( geometry, material );
				cube.position.y = 150;
				scene.add( cube );
			}

			function leapAnimate( frame ) {
				var countBones = 0;
				var countArms = 0;

				armMeshes.forEach( function( item ) { scene.remove( item ) } );
				boneMeshes.forEach( function( item ) { scene.remove( item ) } );
				
				for ( var hand of frame.hands ) {
					for ( var finger of hand.fingers ) {
						for ( var bone of finger.bones ) {
							if ( countBones++ === 0 ) { continue; }
							var boneMesh = boneMeshes [ countBones ] || addMesh( boneMeshes );
							updateMesh( bone, boneMesh );
						}
					}
					var arm = hand.arm;
					var armMesh = armMeshes [ countArms++ ] || addMesh( armMeshes );
					updateMesh( arm, armMesh );
					armMesh.scale.set( arm.width / 4, arm.width / 2, arm.length );
				}
				renderer.render( scene, camera );
				controls.update();
				// requestAnimationFrame( leapAnimate );
				stats.update();
			}
		</script>
	</body>
</html>